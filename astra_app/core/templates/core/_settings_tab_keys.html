<form method="post" novalidate data-settings-save-all="1">
	{% csrf_token %}
	<input type="hidden" name="tab" value="keys" />

	{% if keys_form.non_field_errors %}
		<div class="alert alert-danger">{{ keys_form.non_field_errors }}</div>
	{% endif %}

	<div class="form-group">
		<label>{{ keys_form.fasGPGKeyId.label }}</label>

		<div id="gpg-keys-widget" class="d-none">
			<div class="table-responsive">
				<table class="table table-sm table-bordered align-middle mb-2" id="gpg-keys-table">
					<tbody></tbody>
				</table>
			</div>
			<button type="button" class="btn btn-sm btn-outline-secondary" id="gpg-keys-add" title="Add another GPG key ID">Add GPG key ID</button>
		</div>

		<div id="gpg-keys-fallback">
			{{ keys_form.fasGPGKeyId }}
			{% if keys_form.fasGPGKeyId.help_text %}<small class="form-text text-muted">{{ keys_form.fasGPGKeyId.help_text }}</small>{% endif %}
			{% if keys_form.fasGPGKeyId.errors %}<div class="text-danger">{{ keys_form.fasGPGKeyId.errors }}</div>{% endif %}
		</div>
	</div>

	<div class="form-group">
		<label>{{ keys_form.ipasshpubkey.label }}</label>

		<div id="ssh-keys-widget" class="d-none">
			<div class="table-responsive">
				<table class="table table-sm table-bordered align-middle mb-2" id="ssh-keys-table">
					<tbody></tbody>
				</table>
			</div>
			<button type="button" class="btn btn-sm btn-outline-secondary" id="ssh-keys-add" title="Add another SSH key">Add SSH key</button>
		</div>

		<div id="ssh-keys-fallback">
			{{ keys_form.ipasshpubkey }}
			{% if keys_form.ipasshpubkey.help_text %}<small class="form-text text-muted">{{ keys_form.ipasshpubkey.help_text }}</small>{% endif %}
			{% if keys_form.ipasshpubkey.errors %}<div class="text-danger">{{ keys_form.ipasshpubkey.errors }}</div>{% endif %}
		</div>
	</div>

	<button type="submit" class="btn btn-primary" title="Save key settings">Save</button>
</form>

<script>
	(function () {
		function onReady(fn) {
			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', fn);
			} else {
				fn();
			}
		}

		onReady(function () {
			setupRowEditor({
				textareaId: 'id_fasGPGKeyId',
				widgetId: 'gpg-keys-widget',
				fallbackId: 'gpg-keys-fallback',
				tableBodySelector: '#gpg-keys-table tbody',
				addBtnId: 'gpg-keys-add',
				rowClass: 'gpg-keys-row',
				kind: 'text',
				placeholder: 'Key ID'
			});

			setupRowEditor({
				textareaId: 'id_ipasshpubkey',
				widgetId: 'ssh-keys-widget',
				fallbackId: 'ssh-keys-fallback',
				tableBodySelector: '#ssh-keys-table tbody',
				addBtnId: 'ssh-keys-add',
				rowClass: 'ssh-keys-row',
				kind: 'textarea',
				placeholder: 'Paste a key'
			});
		});
	})();
</script>
