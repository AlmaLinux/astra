{% extends 'core/base.html' %}

{% load core_membership_notes %}

{% block title %}Membership Request #{{ req.pk }}{% endblock %}

{% block header %}
  <div class="d-flex align-items-center justify-content-between flex-wrap" style="gap: .5rem;">
    <h1 class="m-0">Membership Request #{{ req.pk }}</h1>
    <div class="d-flex align-items-center" style="gap: .5rem;">
      {% if contact_url %}
        <a href="{{ contact_url }}" class="btn btn-sm btn-outline-primary" title="Contact the requester">Contact</a>
      {% endif %}
      <a href="{% url 'membership-requests' %}" class="btn btn-sm btn-outline-secondary" title="Return to request list">Back to requests</a>
    </div>
  </div>
{% endblock %}

{% block content %}
  <div class="card">
    <div class="card-body">
      {% if embargoed_country_code %}
        <div class="alert alert-warning" role="alert">
          <strong>Compliance warning:</strong>
          This user's declared country, {{ embargoed_country_label|default:embargoed_country_code }}, is on the list of embargoed countries.
        </div>
      {% endif %}

      <dl class="row mb-0">
        <dt class="col-sm-3">Status</dt>
        <dd class="col-sm-9">{{ req.get_status_display }}</dd>

        <dt class="col-sm-3">Requested at</dt>
        <dd class="col-sm-9">{{ req.requested_at }}</dd>

        {% if requested_by_username %}
          <dt class="col-sm-3">Requested by</dt>
          <dd class="col-sm-9">
            <a href="{% url 'user-profile' requested_by_username %}">
              {% if requested_by_full_name %}
                {{ requested_by_full_name }} <span class="text-muted">({{ requested_by_username }})</span>
              {% else %}
                {{ requested_by_username }}
              {% endif %}
            </a>
            {% if requested_by_deleted %}
              <span class="text-muted">(deleted)</span>
            {% endif %}
          </dd>
        {% endif %}

        {% if req.is_organization_target or not requested_by_username or req.target_identifier != requested_by_username %}
          <dt class="col-sm-3">Requested for</dt>
          <dd class="col-sm-9">
            {% include 'core/_membership_request_target_display.html' with req=req full_name=target_full_name target_deleted=target_deleted %}
          </dd>
        {% endif %}

        <dt class="col-sm-3">Type</dt>
        <dd class="col-sm-9">{{ req.membership_type.name }}</dd>

        {% if req.decided_at %}
          <dt class="col-sm-3">Decided at</dt>
          <dd class="col-sm-9">{{ req.decided_at }}</dd>
        {% endif %}

        {% if req.decided_by_username %}
          <dt class="col-sm-3">Decided by</dt>
          <dd class="col-sm-9">{{ req.decided_by_username }}</dd>
        {% endif %}
      </dl>

      {% if req.responses %}
        <hr>
        <h6 class="text-muted">Request responses</h6>
        {% include 'core/_membership_request_responses.html' with request_obj=req organization=None as_details=False %}
      {% endif %}

      {% if membership_can_view %}
        <hr>
        {% membership_notes req %}
      {% endif %}

      {% if req.status == 'pending' or req.status == 'on_hold' %}
        <hr>
        <div class="membership-request-actions membership-request-actions--detail">
          {% include 'core/_membership_request_actions.html' with request=req show_on_hold_approve=show_on_hold_approve %}
        </div>
      {% endif %}
    </div>
  </div>

  {% include 'core/_membership_request_shared_modals.html' %}
{% endblock %}
